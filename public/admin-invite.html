<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
</head>
<body>
<h2>Admin Panel</h2>
<button onclick="logout()">Logout</button>

<h3>Pending Requests</h3>
<table border="1">
<thead><tr><th>Email</th><th>Dept</th><th>Action</th></tr></thead>
<tbody id="pendingBody"></tbody>
</table>

<h3>Approved Officials</h3>
<table border="1">
<thead><tr><th>Email</th><th>Dept</th><th>Access Key</th></tr></thead>
<tbody id="approvedBody"></tbody>
</table>

<script>
const TOKEN = localStorage.getItem("ADMIN_TOKEN");
if(!TOKEN) window.location.href="admin.html";

function logout(){ localStorage.removeItem("ADMIN_TOKEN"); window.location.href="admin.html"; }

async function fetchTables(){
    const pend = await fetch("/api/admin/requests",{headers:{"Authorization":"Bearer "+TOKEN}});
    const pending = await pend.json();
    const pb = document.getElementById("pendingBody");
    pb.innerHTML="";
    for(const email in pending){
        const r = pending[email];
        const tr = document.createElement("tr");
        tr.innerHTML=`<td>${r.email}</td><td>${r.department}</td>
        <td><button onclick="approve('${r.email}')">Approve</button></td>`;
        pb.appendChild(tr);
    }

    const app = await fetch("/api/admin/approved",{headers:{"Authorization":"Bearer "+TOKEN}});
    const approved = await app.json();
    const ab = document.getElementById("approvedBody");
    ab.innerHTML="";
    for(const email in approved){
        const r = approved[email];
        const tr = document.createElement("tr");
        tr.innerHTML=`<td>${r.email}</td><td>${r.department}</td><td>${r.accessKey}</td>`;
        ab.appendChild(tr);
    }
}
async function approve(email){
    const res = await fetch("/api/admin/approve",{
        method:"POST",
        headers:{
            "Authorization":"Bearer "+TOKEN,
            "Content-Type":"application/json"
        },
        body:JSON.stringify({email})
    });
    const data = await res.json();
    alert("Approved: "+data.accessKey);
    fetchTables();
}
fetchTables();
</script>
</body>
</html>
