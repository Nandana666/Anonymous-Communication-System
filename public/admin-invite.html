<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Admin Invite & Approvals</title>
  <style>
    body{font-family:Arial;margin:20px;}
    table{border-collapse:collapse;width:80%}
    td,th{border:1px solid #ccc;padding:5px;text-align:left;}
    button{padding:3px 8px;margin:2px;}
  </style>
</head>
<body>
<h2>Admin Panel â€“ Invite & Approvals</h2>
<button onclick="logout()">Logout</button>

<h3>Pending Requests</h3>
<table>
<thead><tr><th>Email</th><th>Department</th><th>Action</th></tr></thead>
<tbody id="pending"></tbody>
</table>

<h3>Approved Officials</h3>
<table>
<thead><tr><th>Email</th><th>Department</th><th>Access Key</th></tr></thead>
<tbody id="approved"></tbody>
</table>

<script>
const TOKEN = localStorage.getItem("ADMIN_JWT");
if(!TOKEN) window.location.href="admin.html";

async function loadPending(){
  const r = await fetch("http://localhost:5000/api/admin/requests",{
    headers: { Authorization: "Bearer "+TOKEN }
  });
  const data = await r.json();
  const tbody = document.getElementById("pending");
  tbody.innerHTML = "";
  for(const email in data){
    const dep = data[email].department;
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${email}</td><td>${dep}</td>
      <td><button onclick="approve('${email}')">Approve</button></td>`;
    tbody.appendChild(tr);
  }
}

async function loadApproved(){
  const r = await fetch("http://localhost:5000/api/admin/approved",{
    headers: { Authorization: "Bearer "+TOKEN }
  });
  const data = await r.json();
  const tbody = document.getElementById("approved");
  tbody.innerHTML = "";
  for(const email in data){
    const off = data[email];
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${off.email}</td><td>${off.department}</td><td>${off.accessKey}</td>`;
    tbody.appendChild(tr);
  }
}

async function approve(email){
  const r = await fetch("http://localhost:5000/api/admin/approve",{
    method:"POST",
    headers:{ "Content-Type":"application/json", Authorization: "Bearer "+TOKEN },
    body: JSON.stringify({ email })
  });
  const data = await r.json();
  alert(`Invite code generated for ${email}: ${data.inviteCode}`);
  loadPending();
  loadApproved();
}

function logout(){
  localStorage.removeItem("ADMIN_JWT");
  window.location.href="admin.html";
}

// Initial load
loadPending();
loadApproved();
</script>
</body>
</html>
