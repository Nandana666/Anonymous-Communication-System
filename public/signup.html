<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Official Signup</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="signup-card">
  <h2>Official Signup Request</h2>

  <input id="email" placeholder="Official Email">
  <select id="department">
    <option value="Police">Police</option>
    <option value="Cyber">Cyber</option>
    <option value="Fire">Fire</option>
    <option value="Health">Health</option>
  </select>

  <div>
    <button onclick="requestSignup()">Submit Request</button>
    <button onclick="checkStatus()">Check Approval</button>
  </div>

  <div id="msg"></div>

  <div id="popup" style="display:none;">
    <h3>Approved âœ…</h3>
    <p><b>Access Key:</b></p>
    <input id="accessKey" readonly>
    <button onclick="copyKey()">Copy</button>
  </div>
</div>

<script>
//const API = "http://localhost:5000";

async function requestSignup(){
  const email = document.getElementById("email").value;
  const department = document.getElementById("department").value;
  const msg = document.getElementById("msg");

  try{
    const res = await fetch("/api/official/request", {
      method: "POST",
      headers: { "Content-Type":"application/json" },
      body: JSON.stringify({ email, department })
    });
    const data = await res.json();
    msg.innerText = data.message || data.error;
    msg.style.color = data.message ? "green" : "red";
  }catch(e){ msg.innerText = e.message; msg.style.color="red"; }
}

async function checkStatus(){
  const email = document.getElementById("email").value;
  if(!email) return alert("Enter email!");
  try{
    const res = await fetch("/api/official/status?email=" + email);
    const data = await res.json();
    if (!data.approved) { alert("Not approved yet"); return; }

    document.getElementById("popup").style.display = "block";
    document.getElementById("accessKey").value = data.accessKey;
  }catch(e){ alert(e.message); }
}

function copyKey(){
  const key = document.getElementById("accessKey");
  key.select();
  document.execCommand("copy");
  alert("Access Key Copied!");
}
</script>
</body>
</html>
